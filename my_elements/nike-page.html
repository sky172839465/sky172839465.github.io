<link rel=import href=../bower_components/google-chart/google-chart.html><link rel=import href=../bower_components/app-datepicker/app-datepicker.html><link rel=import href=../bower_components/byutv-jsonp/byutv-jsonp.html><dom-module id=nike-page><style is=custom-style include=app-grid-style>.nike-content-area{margin:-5% auto;width:100%}.date-area{margin:0 auto}paper-card{width:92%;margin:3% 4% 0 4%}.itemTitle{color:var(--paper-grey-600);margin:1% 0;font-size:90%}.road-icon{color:var(--paper-grey-700)}.builder-icon{color:var(--google-green-300)}.whatshot-icon{color:var(--paper-red-900)}.paw-icon{color:var(--paper-brown-700)}.err-msg{color:var(--paper-red-900);font-size:150%;text-align:center}.chart-area{width:100%;margin:0 auto;vertical-align:middle}google-chart{width:100%;height:60vh;margin:0 auto}#searchRecords{margin:0 10% 0 10%;width:80%;height:10%;font-size:130%;background:#f5f5f5}h3{text-align:center}:host{--app-grid-columns:2;--app-grid-gutter:10px;--app-grid-expandible-item-columns:2}ul{padding:0;list-style:none}.item{list-style:none}@media (max-width:999px){.item:nth-child(n){@apply(--app-grid-expandible-item)}}</style><template><div hidden={{isLoading}}><ul class=app-grid><li><div class=date-area><h3>Start Date</h3><app-datepicker auto-update-date show-long-date={{showLongDate}} date={{startDate}} disable-days=[] input-date={{defaultDate}} min-date=2015-02-26 max-date={{endDate}}></app-datepicker></div><li><div class=date-area><h3>End Date</h3><app-datepicker auto-update-date show-long-date={{showLongDate}} date={{endDate}} disable-days=[] min-date={{startDate}}></app-datepicker></div></ul><br><div class=nike-content-area><paper-button raised id=searchRecords on-click=_searchRecords> <iron-icon icon=own:search></iron-icon>&nbsp;&nbsp;Search </paper-button></div></div><template is=dom-if if={{isMobile}}><div class=err-msg>{{locales.nike.mobileMsg}}</div></template><template is=dom-if if={{!isMobile}}><byutv-jsonp auto url="https://163.15.192.185/~hsunight/" last-response={{result}} on-load=success on-error=error debounce-duration={{duration}}></byutv-jsonp> <iron-ajax auto url={{url}} handle-as=json params={{params}} last-response={{info}} on-error=error2 loading={{isLoading}} debounce-duration={{duration}}> </iron-ajax><div class=chart-area><google-chart type=column options="{
					&#34;backgroundColor&#34;: &#34;transparent&#34;,
					&#34;width&#34;: &#34;100vw&#34;,
					&#34;height&#34;: &#34;100%&#34;,
					&#34;chartArea&#34;: {
						&#34;height&#34;: &#34;80%&#34;,
						&#34;width&#34;: &#34;80%&#34;
					},
					&#34;hAxis&#34;: {&#34;title&#34;: &#34;Date&#34;},
					&#34;vAxis&#34;: {&#34;title&#34;: &#34;KM&#34;}				
				}" data={{_chart(info)}}> </google-chart></div></template><div class=nike-content-area><template is=dom-if if={{errorMsg}}><div class=err-msg>{{locales.nike.msg}}</div></template><template is=dom-repeat items={{info.data}} as=data><paper-card heading="{{_compare(data.startTime, 'title', index)}}"><div class=card-content><ul class=app-grid><li><div class=itemTitle>{{locales.nike.distance.title}}</div><div><iron-icon class=road-icon icon=fa:fa-road></iron-icon> {{_compare(data.metricSummary.distance, 'distance', index)}} {{locales.nike.distance.unit}}</div><li><div class=itemTitle>{{locales.nike.duration.title}}</div><div><iron-icon class=builder-icon icon=own:query-builder></iron-icon> {{_compare(data.metricSummary.duration, 'duration', index)}} {{locales.nike.duration.unit}}</div></ul><br><ul class=app-grid><li><div class=itemTitle>{{locales.nike.calories.title}}</div><div><iron-icon class=whatshot-icon icon=own:whatshot></iron-icon> {{data.metricSummary.calories}} {{locales.nike.calories.unit}}</div><li><div class=itemTitle>{{locales.nike.steps.title}}</div><div><iron-icon class=paw-icon icon=fa:fa-paw></iron-icon> {{data.metricSummary.steps}} {{locales.nike.steps.unit}}</div></ul></div></paper-card> <br></template></div><br></template><script>Polymer({is:'nike-page',properties:{locales:{type:JSON,notify:true},isMobile:{type:Boolean,notify:true},showLongDate:{type:Boolean,value:false},result:{type:JSON,notify:true},duration:{type:String,value:"300",notify:true},url:{type:String,notify:true},params:{type:Object,notify:true},count:{type:String,value:"10",notify:true},start:{type:String,value:"",notify:true},end:{type:String,value:"",notify:true},errorMsg:{type:Boolean,notify:true},info:{type:JSON,notify:true},startDate:{type:String,notify:true},defaultDate:{type:String,notify:true},endDate:{type:String,notify:true},packageList:{type:Array,value:["bower_components/google-chart/google-chart","bower_components/app-datepicker/app-datepicker","bower_components/byutv-jsonp/byutv-jsonp"]}},ready:function(){for(var i in this.packageList){var packageInfo=this.packageList[i].split("/");var packageItem=document.getElementById(packageInfo[packageInfo.length-1]);if(!Polymer.isInstance(packageItem))
this.importHref(this.packageList[i]+".html");}},attached:function(){if(!this.isMobile){$(".nike-content-area, .date-area").css("width","700px");}else{document.getElementById("spinner").isLoading=false;}},success:function(){var range="";if(this.startDate!=this.endDate){range="?startDate="+parseDate(this.startDate,true)+"&endDate="+parseDate(this.endDate,true);}
this.url=decodeURI("https://api.nike.com/v1/me/sport/activities/running"+range);this.set("params",{access_token:this.result.access_token,count:this.count});},error:function(){console.log("error");this.errorMsg=true;},error2:function(){this.duration=Math.floor((Math.random()*100)+1)*100;},_compare:function(value,type,index){var compareValue="";switch(type){case"title":compareValue=value.split("T")[0];break;case"distance":compareValue=parseFloat(value).toFixed(2);break;case"duration":compareValue=value.split(".")[0];break;}
if(index==(this.info.data.length-1)&&type=="title"){var date=compareValue.split("-");this.defaultDate=date[0]+"/"+date[1]+"/"+date[2];}
return compareValue;},_chart:function(info){var data=[];for(var i in info.data){var date=(info.data[i].startTime.split("T")[0]).split("-");var distance=parseFloat(info.data[i].metricSummary.distance).toFixed(2);data.unshift([date[1]+"/"+date[2],parseFloat(distance),"opacity: 0.4"]);}
data.unshift(["distance","km",{"role":"style"}]);return data;},_searchRecords:function(){var count=daydiff(parseDate(this.startDate,false),parseDate(this.endDate,false));this.isLoading=true;this.count=count;var range="?startDate="+parseDate(this.startDate,true)+"&endDate="+parseDate(this.endDate,true);this.url=decodeURI("https://api.nike.com/v1/me/sport/activities/running"+range);this.set("params",{access_token:this.result.access_token,count:this.count});},_test:function(){this.$.animated.open();}});function parseDate(date,isURL){var mdy=date.split('/');if(isURL)
return(mdy[0]+"-"+mdy[1]+"-"+mdy[2]);else
return new Date(mdy[0],mdy[1],mdy[2]);}
function daydiff(firstDate,secondDate){var oneDay=24*60*60*1000;return Math.round(Math.abs((firstDate.getTime()-secondDate.getTime())/(oneDay)));;}</script></dom-module>